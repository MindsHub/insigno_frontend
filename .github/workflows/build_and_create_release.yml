name: Build and create release
on: workflow_dispatch

env:
  BUILD_DIR: /home/vagrant/build/org.mindshub.insigno

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v3
        with:
          submodules: true
      - name: Move repo to correct place
        run: |
          sudo mkdir -p "$BUILD_DIR"
          sudo chown runner "$BUILD_DIR"
          mv ${{ github.workspace }} "$BUILD_DIR"
          mkdir ${{ github.workspace }}
      - name: Setup flutter
        run: |
          cd /home/vagrant/build/org.mindshub.insigno
          export PUB_CACHE=/home/vagrant/build/org.mindshub.insigno/.pub-cache
#          submodules/flutter/bin/flutter config --no-analytics
#          submodules/flutter/bin/flutter pub get
      - name: Build
      - name: Move repo back to avoid cleanup issues
        run: |
          mv /home/vagrant/build/org.mindshub.insigno ${{ github.workspace }}

